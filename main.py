# Package import
import os

import flask
from flask import Flask, render_template, send_file, make_response, url_for, Response, redirect, request

# initialise app
import xml_handling

app = Flask(__name__)


@app.route('/script.html', methods=["GET"])
def script():
    return send_file("templates/script.html")


# decorator for homepage
@app.route('/')
def upload_xml():
    return render_template('index.html',
                           PageTitle="Uploading xml")


@app.route('/', methods=["POST"])
def ret_file():
    # gathering file from form
    uploaded_file = request.files['xml_file']

    # making sure its not empty
    if uploaded_file.filename != '':
        # reading the file
        uploaded_file.save(uploaded_file.filename)
        # converting to a string.
        root = xml_handling.parse_xml_from_file(uploaded_file.filename)
        xml_str = xml_handling.get_str_from_xml_elem(root)
        os.remove(uploaded_file.filename)
        return  Response(xml_str)
        # The created image will be opened on a new page
    else:
        return render_template('index.html',
                               PageTitle="Landing page")
    # This just reloads the page if no file is selected and the user tries to POST.


if __name__ == '__main__':
    app.run(debug=True)
